#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ Linux –≤–µ—Ä—Å–∏–∏

set -e

echo "üî® –°–±–æ—Ä–∫–∞ Linux –≤–µ—Ä—Å–∏–∏ Instagram Reels Publisher..."
echo "üìå –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: Linux"
echo "üìå –î–ª—è Windows –∏—Å–ø–æ–ª—å–∑—É–π build.bat –Ω–∞ Windows –º–∞—à–∏–Ω–µ –∏–ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ uv
if ! command -v uv &> /dev/null; then
    echo "‚ùå uv –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ uv: curl -LsSf https://astral.sh/uv/install.sh | sh"
    exit 1
fi

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç PyInstaller –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
echo "üì¶ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
uv sync

# –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–±–æ—Ä–∫–∏
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–±–æ—Ä–æ–∫..."
rm -rf build dist

# –°–æ–±–∏—Ä–∞–µ–º —Å –ø–æ–º–æ—â—å—é PyInstaller —á–µ—Ä–µ–∑ uv
echo "üì¶ –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
uv run pyinstaller build.spec \
    --clean \
    --noconfirm

# –ö–æ–ø–∏—Ä—É–µ–º –±—Ä–∞—É–∑–µ—Ä—ã Playwright –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
echo "üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–≤ Playwright..."
PLAYWRIGHT_BROWSERS_PATH=$(uv run python -c "from playwright.sync_api import sync_playwright; p = sync_playwright().start(); print(p.chromium.executable_path)" 2>/dev/null || echo "")

if [ -n "$PLAYWRIGHT_BROWSERS_PATH" ]; then
    echo "‚úÖ –ë—Ä–∞—É–∑–µ—Ä—ã Playwright –Ω–∞–π–¥–µ–Ω—ã"
    # –ë—Ä–∞—É–∑–µ—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
else
    echo "‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä—ã Playwright –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –û–Ω–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ."
fi

echo ""
echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "üìÅ –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤: dist/instagram-reels-publisher"
echo "üñ•Ô∏è  –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: Linux (x86_64)"
echo ""
echo "üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Camoufox/Playwright –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä—ã."
echo "   –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏."
echo ""
echo "üìù –î–ª—è —Å–±–æ—Ä–∫–∏ Windows –≤–µ—Ä—Å–∏–∏:"
echo "   1. –ò—Å–ø–æ–ª—å–∑—É–π Windows –º–∞—à–∏–Ω—É –∏ –∑–∞–ø—É—Å—Ç–∏ build.bat"
echo "   2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É Windows"
echo "   3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π Wine (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)"
